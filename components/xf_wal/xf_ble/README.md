# XF BLE

xf_ble 文件夹主要是 xf_ble 抽象层接口，不依赖 XF, 具体对接实现在 ports 里面。

目前已抽象的功能概况：
- 广播、扫描；
- 连接、断连；
- 服务添加与发现；
- 特征添加与发现；
- 特征描述符添加与发现；
- 特征值读写请求；
- 通知或指示；

目前待抽象的功能概况：
- 配对、密钥、加密等 SMP 相关的功能

目前已抽象的接口：

- GAP:
    - 使能 BLE 
    - 失能 BLE 
    - 设置本地设备地址
    - 获取本地设备地址
    - 设置本地设备外观
    - 获取本地设备外观
    - 设置本地设备名称
    - 获取本地设备名称
    - 设置广播数据
    - 设置广播参数
    - 开始广播
    - 停止广播
    - 设置扫描参数
    - 开始扫描
    - 停止扫描
    - 更新连接参数
    - 与设备建立连接
    - 与设备断开连接
    - 与指定设备配对
    - 取消与指定设备的配对
    - 取消所有设备的配对

- GATTC
    - 注册gattc应用profile（app_profile）（非BLE标准要求）
    - 注销gattc应用profile（app_profile）（非BLE标准要求）
    - 搜寻（发现）服务（指定服务UUID或所有服务）
    - 搜寻（发现）特征（指定特征UUID或服务的所有特征）
    - 搜寻（发现）特征描述符（所有描述符）
    - 搜寻（发现）特征描述符（特征（指定特征UUID）下的特征描述符）
    - 搜寻（发现）特征描述符（特征（指定特征句柄）下的特征描述符）
    - 发送（特征值）读请求通过句柄
    - 发送（特征值）读请求通过UUID
    - 发送（特征值）写请求（无需回应：命令；需要回应：数据）
    - 发送协商MTU 请求
    - 事件回调注册，目前已支持的事件：
        - GAP
            - 扫描参数设置事件
            - 获取到扫描结果事件
            - 连接事件
            - 断连事件
        - GATTC
            - 发现服务完成（考虑去除服务、特征、特征描述符的回调，改在调用时直接阻塞等待结果即可）
            - MTU协商完成
            - （特征值）读请求完成
            - （特征值）写请求完成
            - 接收到通知或指示

- GATTS
    - 注册gatts应用profile（app_profile）（非BLE标准要求）
    - 注销gatts应用profile（app_profile）（非BLE标准要求）
    - 添加服务集（多个服务）到app_profile
    - 添加服务到app_profile
    - 启动服务
    - 停止服务
    - 删除指定app_profile下的所有服务
    - 发送通知（需要确认）或指示（无需确认）
    - 发送（客户端的）请求的回应
    - 事件回调注册，目前已支持的事件：
        - GAP
            - 连接事件
            - 断连事件
            - 广播启动事件
            - 广播停止事件
            - 连接参数更新事件
        - GATTS
            - 服务添加事件（考虑去除服务、特征、特征描述符添加的回调，改在调用添加服务时，遍历添加其下特征及特征描述符时直接阻塞等待结果即可）
            - 服务移除事件
            - 特征添加事件
            - 特征描述符事件
            - 服务启动事件
            - 服务停止事件
            - 接收到读请求（特征值）事件
            - 接收到写请求（特征值）事件
            - 接收到MTU协商事件

将要抽象的功能：
- GAP:
    - 绑定已解绑
    - SMP（Secure manager protocol）相关的功能：配对、密钥、加密等

- GATTC
    - 完善搜寻（发现）特征描述符（特征（指定特征句柄）下的特征描述符）

- GATTS
    - 完善添加特征描述符

    其他：
    - 对接IDF bluedroid或nimble，修正、完善前面抽象的接口


## ws63

WS63目前对接情况：

- GAP:
    - 使能 BLE 
    - 失能 BLE 
    - 设置本地设备地址
    - 获取本地设备地址
    - 设置本地设备外观
    - 获取本地设备外观
    - 设置本地设备名称
    - 获取本地设备名称
    - 设置广播数据
    - 设置广播参数
    - 开始广播
    - 停止广播
    - 设置扫描参数
    - 开始扫描
    - 停止扫描
    - 更新连接参数
    - 与设备建立连接
    - 与设备断开连接
    - ~~与指定设备配对~~
    - ~~取消与指定设备的配对~~
    - ~~取消所有设备的配对~~

- GATTC
      - 注册gattc应用profile（app_profile）（非BLE标准要求）
      - 注销gattc应用profile（app_profile）（非BLE标准要求）
      - 搜寻（发现）服务（指定服务UUID或所有服务）
      - 搜寻（发现）特征（指定特征UUID或服务的所有特征）
      - 搜寻（发现）特征描述符（所有描述符）
      - 搜寻（发现）特征描述符（特征（指定特征UUID）下的特征描述符）
      - 搜寻（发现）特征描述符（特征（指定特征句柄）下的特征描述符）
      - 发送（特征值）读请求通过句柄
      - 发送（特征值）读请求通过UUID
      - 发送（特征值）写请求（无需回应：命令；需要回应：数据）
      - 发送协商MTU 请求
      - 事件回调注册，目前已支持的事件：
          - GAP
              - ~~扫描参数设置事件~~
              - 获取到扫描结果事件
              - 连接事件
              - 断连事件
          - GATTC
              - ~~发现服务完成~~
              - MTU协商完成
              - （特征值）读请求完成
              - （特征值）写请求完成
              - 接收到通知或指示

- GATTS
      - 注册gatts应用profile（app_profile）（非BLE标准要求）
      - 注销gatts应用profile（app_profile）（非BLE标准要求）
      - 添加服务集（多个服务）到app_profile
      - 添加服务到app_profile
      - 启动服务
      - 停止服务
      - 删除指定app_profile下的所有服务
      - 发送通知（需要确认）或指示（无需确认）
      - 发送（客户端的）请求的回应
      - 事件回调注册，目前已支持的事件：
          - GAP
              - 连接事件
              - 断连事件
              - 广播启动事件
              - 广播停止事件
              - 连接参数更新事件（ws63回调的参数有点不一样，仅唤起了回调，传入参数为无效0值）
          - GATTS
              - ~~服务添加事件~~
              - ~~服务移除事件~~
              - ~~特征添加事件~~
              - ~~特征描述符添加事件~~
              - 服务启动事件
              - 服务停止事件
              - 接收到读请求（特征值）事件
              - 接收到写请求（特征值）事件
              - 接收到MTU协商事件

WS63目前下阶段将对接：

- GAP:
    - 完善、优化广播数据设置流程及体验，补全类型及对应参数形式
    - 对接配对功能
    - 对接绑定功能
    - 对接其他的SMP类功能

- GATTC
    - 补全搜寻（发现）特征描述符功能
    - 事件回调注册，目前已支持的事件：

## st

## espressif

espressif目前对接情况：
    未对接，待对接

## linux

## st
